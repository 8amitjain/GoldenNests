{% extends 'home/base.html' %}
{% load static %}
{% block content %}

<div class="content">
      <!--  section  -->
    <section class="parallax-section hero-section hidden-section" data-scrollax-parent="true">
        <div class="bg par-elem "  data-bg="{% static 'home/images/bg/17.jpg' %}" data-scrollax="properties: { translateY: '30%' }"></div>
        <div class="overlay"></div>
        <div class="container">
            <div class="section-title">
                <h4>Order food with home delivery</h4>
                <h2>Your Cart</h2>
                <div class="dots-separator fl-wrap"><span></span></div>
            </div>
        </div>
        <div class="hero-section-scroll">
            <div class="mousey">
                <div class="scroller"></div>
            </div>
        </div>
        <div class="brush-dec"></div>
    </section>
    <!--  section  end-->

    <!--  section  -->
    <section class="hidden-section">
        <div class="container">
            <!-- CHECKOUT TABLE -->
            <div class="row">
                <div class="col-md-8">
                    {% if cart %}
                        <h4 class="cart-title">Your cart <span>{{ cart_count }} items</span></h4>
                    {% endif %}
                    <table class="table table-border checkout-table" style="overflow: auto;">
                        <tbody>
                            <tr>
<!--                                <th class="hidden-xs">Item</th>-->
                                <th width="30%" style="color: #C19D60;">Dish</th>
                                <th class="hidden-xs">Price</th>
                                <th>Count</th>
                                <th>Total</th>
                                <th></th>
                            </tr>
                            {% for object in object_list %}
                                <tr>
<!--                                    <td class="hidden-xs">-->
<!--                                        {% if object.product.image %}-->
<!--                                            <a href="{% url 'menu:menu' %}"><img src="{{ object.product.image.url }}" alt="" class="respimg"></a>-->
<!--                                        {% endif %}-->
<!--                                    </td>-->
                                    <td>
                                        <h5 class="product-name">{{ object.product.title }}</h5>
                                    </td>
                                    <td class="hidden-xs">
                                        <h5 class="order-money">₹{{ object.product.price }}</h5>
                                    </td>
                                    <td>
                                        <center><div style="display: flex;background: #292929;width: 95px;" id="max{{object.id}}">
                                            <a style="color: #C19D60;padding: 0.5em 1em;" id="less{{object.id}}"><i class="fa fa-minus" aria-hidden="true" style="margin-top: 0.7em;font-size: 0.7em;"></i></a>
                                            <p style="padding: 0.5em;" id="quantity_{{object.id}}">{{object.quantity}}</p>
                                            <a style="color: #C19D60;padding: 0.5em 1em;" id="add{{object.id}}"><i class="fa fa-plus" aria-hidden="true" style="margin-top: 0.7em;font-size: 0.7em;"></i></a>
                                        </div></center>
<!--                                        <input type="number" name="cartin1" value="{{ cart.quantity }}" max="50" min="0" class="order-count">-->
                                    </td>
                                    <td>
                                        <h5 class="order-money" id="get_cart_total_{{object.id}}">₹{{ object.get_total_item_price }}</h5>
                                    </td>
                                    <td class="pr-remove">
<!--                                        <a href="{{ cart.get_remove_from_cart_url }}" title="Remove"><i class="fal fa-times"></i></a>-->
                                        <a href="{% url 'order:remove-from-cart' object.id %}" title="Remove"><i class="fal fa-times"></i></a>
                                    </td>
                                </tr>

                               <script>
                                                        var object_id = "#quantity_{{object.id}}";
                                                        console.log(object_id);

                                                     $(document).ready(function(){
                                                         $("#add{{object.id}}").click(function () {
                                                             console.log('works');
                                                               var url = "{% url 'order:add-to-cart' object.product.id %}";
                                                              var quantity = parseInt(document.getElementById("quantity_{{object.id}}").innerHTML) + 1;  // get the selected country ID from the HTML input
                                                                                console.log(quantity, 'quantity');
                                                                                console.log(url, 'url');

                                                              $.ajax({                       // initialize an AJAX request
                                                                url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
                                                                data: {
                                                                  'quantity': quantity,       // add the country id to the GET parameters
                                                                  'variation': {% if object.variation %}{{object.variation.id}}{% else %} 0 {% endif %},       // add the country id to the GET parameters
                                                                },
                                                                success: function (data) {   // `data` is the return of the `load_cities` view function
                                                                  if(data["quantity"] != null ){
                                                                  $("#quantity_{{object.id}}").html(data["quantity"]);
                                                                  }
                                                                  if(data["quantity"] == 10 ){
                                                                     document.getElementById("max{{object.id}}").style.border = "1px solid red";
                                                                  };

                                                                  $("#get_cart_total_{{object.id}}").html("₹" + data["get_cart_total"]);
                                                                  $("#get_total").html("₹" + data["get_total"].toLocaleString('en-IN'));
                                                                  $("#get_total_header").html("₹" + data["get_total"].toLocaleString('en-IN'));
                                                                  $("#get_subtotal").html("₹" + data["get_total_without_coupon"]);
                                                                  $("#item_bag").html(data["item"]);

                                                              }

                                                            });
                                                        });
                                                        $("#less{{object.id}}").click(function () {
                                                             console.log('works');
                                                               var url = "{% url 'order:add-to-cart' object.product.id %}";
                                                              var quantity = parseInt(document.getElementById("quantity_{{object.id}}").innerHTML) - 1;  // get the selected country ID from the HTML input
                                                                                console.log(quantity, 'quantity');
                                                                                console.log(url, 'url');

                                                              $.ajax({                       // initialize an AJAX request
                                                                url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
                                                                data: {
                                                                  'quantity': quantity,       // add the country id to the GET parameters
                                                                  'variation': {% if object.variation %}{{object.variation.id}}{% else %} 0 {% endif %},       // add the country id to the GET parameters
                                                                },
                                                                success: function (data) {
                                                                  document.getElementById("max{{object.id}}").style.border = "0px solid black";
                                                                  if(data["quantity"] != null ){
                                                                  $("#quantity_{{object.id}}").html(data["quantity"]);
                                                                  $("#get_cart_total_{{object.id}}").html("₹" + data["get_cart_total"]);
                                                                  }else{
                                                                  $("#quantity_{{object.id}}").html("0");
                                                                  $("#get_cart_total_{{object.id}}").html("0");
                                                                  }


                                                                  $("#get_total").html("₹" + data["get_total"].toLocaleString('en-IN'));
                                                                  $("#get_total_header").html("₹" + data["get_total"].toLocaleString('en-IN'));
                                                                  $("#get_subtotal").html("₹" + data["get_total_without_coupon"]);
                                                                  $("#item_bag").html(data["item"]);

                                                              }

                                                            });
                                                        });
                                                       });
                                                </script>

                            {% endfor %}
<!--                            <tr>-->
<!--                                <td class="hidden-xs">-->
<!--                                    <a href="#"><img src="images/menu/2.jpg" alt="" class="respimg"></a>-->
<!--                                </td>-->
<!--                                <td>-->
<!--                                    <h5 class="product-name">Cripsy Lobster & Shrimp Bites</h5>-->
<!--                                </td>-->
<!--                                <td class="hidden-xs">-->
<!--                                    <h5 class="product-title order-money">$22.00</h5>-->
<!--                                </td>-->
<!--                                <td>-->
<!--                                    <input type="number" name="cartin2" value="2" max="50" min="1" class="order-count">-->
<!--                                </td>-->
<!--                                <td>-->
<!--                                    <h5 class="order-money">$22.00</h5>-->
<!--                                </td>-->
<!--                                <td class="pr-remove">-->
<!--                                    <a href="#" title="Remove"><i class="fal fa-times"></i></a>-->
<!--                                </td>-->
<!--                            </tr>-->
<!--                            <tr>-->
<!--                                <td class="hidden-xs">-->
<!--                                    <a href="#"><img src="images/menu/3.jpg" alt="" class="respimg"></a>-->
<!--                                </td>-->
<!--                                <td>-->
<!--                                    <h5 class="product-name">Chicken tortilla soup</h5>-->
<!--                                </td>-->
<!--                                <td class="hidden-xs">-->
<!--                                    <h5 class="product-title order-money">$37.00</h5>-->
<!--                                </td>-->
<!--                                <td>-->
<!--                                    <input type="number" name="cartin3" value="1" max="50" min="1" class="order-count">-->
<!--                                </td>-->
<!--                                <td>-->
<!--                                    <h5 class="order-money">$37.00</h5>-->
<!--                                </td>-->
<!--                                <td class="pr-remove">-->
<!--                                    <a href="#" title="Remove"><i class="fal fa-times"></i></a>-->
<!--                                </td>-->
<!--                            </tr>-->
                        </tbody>
                    </table>
                    <!-- COUPON -->
                    <div class="coupon-holder">
                        <form action="{% url 'order:coupon' %}" method="POST">
                            {% csrf_token %}
                            <input type="text" name="code" id="id_code" placeholder="Coupon code">
                            <button type="submit" class="btn-a">Apply</button>
                        </form>
<!--                        <button type="submit" class="pull-right btn-uc">Update Cart</button>-->
                    </div>
                    <!-- /COUPON -->
                </div>
                <div class="col-md-4">
                    <!-- CART TOTALS  -->
                    <div class="cart-totals dark-bg fl-wrap">
                        <h3>Cart totals</h3>
                        <table class="total-table">
                            <tbody>
                                <tr>
                                    <th>Cart Subtotal:</th>
                                    <td id="get_subtotal">₹{{ order.get_total_without_coupon }}</td>
                                </tr>
                                {% if order.get_coupon_total %}
                                <tr>
                                    <th>Coupon Discount:</th>
                                    <td>₹{{ order.get_coupon_total }}</td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <th>Tax:</th>
                                    <td>₹{{ order.get_tax_total }}</td>
                                </tr>
                                <tr>
                                    <th>Total:</th>
                                    <td id="get_total" style="font-size: 1.3em;">₹{{ order.get_total }}</td>
                                </tr>
                            </tbody>
                        </table>
                        <a href="{% url 'order:checkout' %}"><button type="submit" class="cart-totals_btn color-bg">Proceed to Checkout</button></a>
                    </div>
                    <!-- /CART TOTALS  -->
                </div>
            </div>
            <!-- /CHECKOUT TABLE -->
        </div>
        <div class="section-bg">
            <div class="bg"  data-bg="images/bg/dec/section-bg.png"></div>
        </div>
    </section>
    <!--  section end  -->

    <div class="brush-dec2 brush-dec_bottom"></div>
</div>
{% endblock content %}
